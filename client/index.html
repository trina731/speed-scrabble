<!DOCTYPE html>

<!-- I tried moving these things into the body and it didn't work... Not sure why -->
<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
<form id="word-form">
    <input id="word-input" type='text' style='width:500px'></input>
</form>
<div id="playerInfo"></div>
<head>
    <script src="http://localhost:2000/socket.io/socket.io.js"></script>
    <script>
        var c = document.getElementById("ctx");
        ctx = c.getContext("2d");
        ctx.font = '30px Arial';

        var wordForm = document.getElementById('word-form');
        var wordInput = document.getElementById('word-input');
        var playerInfo = document.getElementById('playerInfo');

        var Player = function(id){
            var self = {
                words:[],
                score:0,
                id:id,
                number:"" + Math.floor(100 * Math.random()),
            }
            return self;
        }


        //Hm... I'm not a fan of hardcoding 2000. What if that port is busy for some reason?
        //I guess for now it's ok because it makes it easy to use in the browser, but I think
        //We should look into alternatives
        var socket = io.connect('http://localhost:2000');

        socket.on('newPositions', function(data){
            ctx.clearRect(0,0,500,500);
            for(var i = 0; i < data.length; i++){
                ctx.fillText(data[i].number, data[i].x,data[i].y);
            }
        });

        socket.on('updateWordDisplay', function(data){
            playerInfo.innerHTML = '';
            for(i in data)
                playerInfo.innerHTML += "<p>" + data[i].number + "'s score: " +
                data[i].score + "<br/>" + " Words: " + data[i].words.join(', ') + "</p>";
        })

        socket.on('evalAnswer', function(data){
            console.log(data);
        })

        wordForm.onsubmit = function(e){
            //Prevent automatic page refresh
            e.preventDefault();

            //For debugging purposes: 
            //If you want to see the value of a variable, type in textbox
            //starting with a slash
            //You can also type functions
            if(wordInput.value[0] === '/'){
                socket.emit('evalServer', wordInput.value.slice(1));
            }
            else{
                socket.emit('submitWord', wordInput.value);
            }
            wordInput.value = '';
        }
    </script>
</head>
<body>
</body>