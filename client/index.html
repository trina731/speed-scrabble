<!DOCTYPE html>

<!-- I tried moving these things into the body and it didn't work... Not sure why -->
<canvas id="ctx" width="0" height="0" style="border:1px solid #000000;">
    <div id="array"></div>
</canvas>

<table id="pool"></table>

<button type="button" id="flipBtn">Flip a tile!</button>

<form id="word-form">
    <input id="word-input" type='text' style='width:500px'></input>
</form>
<div id="playerInfo"></div>
<head>
    <script src="http://localhost:2000/socket.io/socket.io.js"></script>
    <script>
        var c = document.getElementById("ctx");
        ctx = c.getContext("2d");
        ctx.font = '30px Arial';

        var wordForm = document.getElementById('word-form');
        var wordInput = document.getElementById('word-input');
        var playerInfo = document.getElementById('playerInfo');
        let btn = document.getElementById('flipBtn');

        var Player = function(id){
            var self = {
                words:[],
                score:0,
                id:id,
                number:"" + Math.floor(100 * Math.random()),
            }
            return self;
        }

        //Hm... I'm not a fan of hardcoding 2000. What if that port is busy for some reason?
        //I guess for now it's ok because it makes it easy to use in the browser, but I think
        //We should look into alternatives
        var socket = io.connect('http://localhost:2000');

        btn.onclick = function(){
            console.log("Requested flip inside index.html");
            socket.emit("requestFlip");
        }

        socket.on("updateFlip", function(data){
                //Render changes
                let table = document.getElementById("pool");
                table.innerHTML = "";

                let numBag = data.length;
                let xSize = 12;
                let ySize = Math.ceil(numBag / xSize);

                let count = 0;
                for(i = 0; i < ySize; i++){
                    let row = table.insertRow();
                    for(j = 0; j < xSize; j++){
                        //Check if there are already enough tiles
                        if(count < numBag){
                            let cell = row.insertCell();
                            let elem = document.createElement("img");
                            let l = data[xSize*i + j];
                            elem.src = "/img/" + l + ".jpg";
                            cell.appendChild(elem);
                            count++;
                        }
                        else
                            break;
                    }
                }


                console.log("data" + data);
                // ctx.clearRect(0,0,500,500);
                // ctx.fillText(data.toString(), 20, 20);
        });

        socket.on('updateWordDisplay', function(data){
            playerInfo.innerHTML = '';
            for(i in data){
                playerInfo.innerHTML += "<p>" + data[i].number + "'s score: " +
                data[i].score + "<br/>" + " Words: " + data[i].words.join(', ') + "</p>";
            }
        });

        socket.on('evalAnswer', function(data){
            console.log(data);
        })

        wordForm.onsubmit = function(e){
            //Prevent automatic page refresh
            e.preventDefault();

            //For debugging purposes: 
            //If you want to see the value of a variable, type in textbox
            //starting with a slash
            //You can also type functions
            if(wordInput.value[0] === '/'){
                socket.emit('evalServer', wordInput.value.slice(1));
            }
            else{
                socket.emit('submitWord', wordInput.value);
            }
            wordInput.value = '';
        }
    </script>

    <style>
        img {
            width: 20px;
        }
    </style>

</head>
<body>
</body>